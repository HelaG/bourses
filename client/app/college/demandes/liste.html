<ui-view>
  <div ng-if="demandes.length === 0 && demandes.$resolved" class="finished">
    <i class="fa fa-thumbs-up"></i>
  </div>

  <table class="table table-striped" ng-if="demandes.length !== 0">
    <thead>
      <tr>
        <th>Enfant</th>
        <th>Demandeur</th>
        <th>Revenu fiscal</th>
        <th>Enfants mineurs</th>
        <th>Enfants majeurs</th>
        <th>Déductibilité</th>
        <th>Notification</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="demande in demandes">
        <td><a ui-sref="layout.college.demandes.edit({demandeId: demande._id})"><i class="fa fa-search"></i> {{demande.identiteEnfant.prenom}} {{demande.identiteEnfant.nom}}</a></td>
        <td>{{demande.identiteAdulte.demandeur.prenoms}} {{demande.identiteAdulte.demandeur.nom}}</td>
        <td>{{demande.data.revenuFiscalReference}} €</td>
        <td>{{demande.foyer.nombreEnfantsACharge}}</td>
        <td>{{demande.foyer.nombreEnfantsAdultes}}</td>
        <td>{{demande.identiteEnfant.regime | deductibilite}}</td>
        <td>
          <div ng-if="status !== 'done'" class="btn btn-action-invert" ng-click="notification(demande)">Éditer</div>
          <div ng-if="status === 'done'" class="btn-group">
            <div class="btn btn-action-invert" ng-click="notification(demande)">Éditer</div>
            <a class="btn btn-action" href="/api/demandes/{{demande._id}}/notification?access_token={{token}}" target="_blank" download="notification_{{demande.identiteEnfant.prenom}}_{{demande.identiteEnfant.nom}}.pdf">
              Télécharger
            </a>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</ui-view>
