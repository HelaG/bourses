<h1>Votre foyer</h1>

<p class="info-lead">
  Nous avons besoin des informations de votre avis d'imposition de l'année <strong>{{nMinus2}}</strong> afin d'en transmettre une copie à votre académie.
</p>

<div class="alert alert-info" role="alert">
  <strong><i class="fa fa-info-circle"></i> À noter :</strong> à titre exceptionnel, vous pouvez renseigner l'avis de {{nMinus1}} en cas de modification importante de la situation familiale entraînant une diminution des ressources depuis {{nMinus2}}.
</div>

<div class="well">
  <div ng-if="status !== 'success'">
    <form name="svairForm" ng-submit="validateSvair(svairForm)" novalidate>
      <div class="form-group required" ng-class="{'has-error': svairForm.numeroFiscal.$invalid && svairForm.$submitted}">
        <label for="numeroFiscal" class="control-label">Votre numéro fiscal</label>
        <input id="numeroFiscal" type="text" name="numeroFiscal" class="form-control" ng-model="newCredentials.numeroFiscal" required>
        <div ng-messages="svairForm.numeroFiscal.$error" ng-if="svairForm.$submitted">
          <p class="help-block" ng-message='required'>Ce champ est obligatoire.</p>
        </div>
      </div>

      <div class="form-group required" ng-class="{'has-error': svairForm.referenceAvis.$invalid && svairForm.$submitted}">
        <label for="referenceAvis" class="control-label">Référence de votre dernier avis d'imposition</label>
        <input id="referenceAvis" type="text" name="referenceAvis" class="form-control" ng-model="newCredentials.referenceAvis" required>
        <div ng-messages="svairForm.referenceAvis.$error" ng-if="svairForm.$submitted">
          <p class="help-block" ng-message='required'>Ce champ est obligatoire.</p>
        </div>
      </div>

      <div ng-if="status === 'error' && error">
        <p class="text-danger">{{error}}</p>
      </div>

      <div class="text-right">
        <a ng-if="status" ng-click="cancelCredentials()" class="btn btn-default btn-lg btn-cancel">
            Annuler
        </a>
        <button type="submit" ladda="loading" data-style="expand-right" name="submit" alt="Valider" class="btn btn-lg btn-primary">
            Valider
        </button>
      </div>
    </form>
  </div>

  <div class="select-identites" ng-if="status === 'success'">
    <div class="form-group">
      <label class="control-label">Vos identités fiscales</label><a class="edit-svair" ng-click="edit()">Modifier</a>
      <div class="identites">
        <div class="identite" ng-if="declarant.nom" ng-repeat="declarant in data.identites">
          <span>{{declarant.prenoms | capitalize:'first'}} {{declarant.nom | capitalize:'first'}}</span>
          <small>Né(e) le {{declarant.dateNaissance}}</small>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label class="control-label">Votre situation familiale</label>
      <div class="identite" ng-if="data.declarant1.nom">
        <span>{{data.situationFamille}}</span>
      </div>
    </div>
  </div>
</div>

<form name="foyerForm" ng-submit="next(foyerForm)" novalidate>
  <div class="form-group required" ng-class="{'has-error': !identite.lien && foyerForm.$submitted}">
    <fieldset>
      <legend class="control-label">
        Vous êtes
      </legend>
      <input type="radio" name="lien" id="lien-pere" ng-model="identite.lien" ng-required="!identite.lien" value="pere">
      <label class="radio-inline" for="lien-pere">Le père</label>
      <input type="radio" name="lien" id="lien-mere" ng-model="identite.lien" ng-required="!identite.lien" value="mere">
      <label class="radio-inline" for="lien-mere">La mère</label>
      <input type="radio" name="lien" id="lien-responsable" ng-model="identite.lien" ng-required="!identite.lien" value="responsable">
      <label class="radio-inline" for="lien-responsable">Le représentant légal</label>
    </fieldset>

    <div ng-if="!identite.lien && foyerForm.$submitted">
      <p class="help-block">Ce champ est obligatoire.</p>
    </div>
  </div>

  <div class="form-group required" ng-class="{'has-error': !identite.garde && foyerForm.$submitted}">
    <fieldset>
      <legend class="control-label">Votre enfant est-il en garde alternée ?</legend>
      <input type="radio" name="garde" id="garde-oui" ng-model="identite.garde" ng-required="!identite.garde" value="oui">
      <label class="radio-inline" for="garde-oui">Oui</label>
      <input type="radio" name="garde" id="garde-non" ng-model="identite.garde" ng-required="!identite.garde" value="non">
      <label class="radio-inline" for="garde-non">Non</label>
    </fieldset>

    <div ng-if="!identite.garde && foyerForm.$submitted">
      <p class="help-block">Ce champ est obligatoire.</p>
    </div>
  </div>

  <div class="form-group required" ng-class="{'has-error': foyerForm.nombreEnfantsACharge.$invalid && foyerForm.$submitted}">
    <label for="nombreEnfantsACharge" class="control-label">
      Nombre d'enfants mineurs ou handicapés
      <br>
      <small>(tel que mentionné sur l'avis d'imposition)</small>
    </label>
    <input type="number" min="0" class="form-control" required name="nombreEnfantsACharge" ng-model="identite.nombreEnfantsACharge">
    <div ng-messages="foyerForm.enfants.$error" ng-if="foyerForm.$submitted">
      <p class="help-block" ng-message='required'>Ce champ est obligatoire.</p>
      <p class="help-block" ng-message='min number'>Cette valeur n'est pas correcte.</p>
    </div>
  </div>

  <div class="form-group required" ng-class="{'has-error': foyerForm.nombreEnfantsAdultes.$invalid && foyerForm.$submitted}">
    <label for="nombreEnfantsAdultes" class="control-label">
      Nombre d'enfants majeurs célibataires
      <br>
      <small>(tel que mentionné sur l'avis d'imposition)</small>
    </label>
    <input type="number" min="0" class="form-control" required name="nombreEnfantsAdultes" ng-model="identite.nombreEnfantsAdultes">
    <div ng-messages="foyerForm.nombreEnfantsAdultes.$error" ng-if="foyerForm.$submitted">
      <p class="help-block" ng-message='required'>Ce champ est obligatoire.</p>
      <p class="help-block" ng-message='min number'>Cette valeur n'est pas correcte.</p>
    </div>
  </div>

  <!-- <div ng-if="identite.garde === 'oui'">
    <div class="well">

      <p class="info-lead">
        <i class="fa fa-info-circle"></i>
        Nous avons également besoin de la déclaration de la deuxieme personne ayant la charge. <br>
        Si vous n'etes pas en mesure de fournir ces elements, vous pouvez passer cette etape. Cette personne devra produire cette piece plus tard.
      </p>

      <div ng-if="statusConjoint !== 'success'">
        <form name="svairFormConjoint" ng-submit="validateSvair(svairFormConjoint)" novalidate>
          <div class="form-group required" ng-class="{'has-error': svairFormConjoint.numeroFiscal.$invalid && svairFormConjoint.$submitted}">
            <label for="numeroFiscal" class="control-label">Votre numéro fiscal</label>
            <input id="numeroFiscal" type="text" name="numeroFiscal" class="form-control" ng-model="newCredentials.numeroFiscal" required>
            <div ng-messages="svairFormConjoint.numeroFiscal.$error" ng-if="svairFormConjoint.$submitted">
              <p class="help-block" ng-message='required'>Ce champ est obligatoire.</p>
            </div>
          </div>

          <div class="form-group required" ng-class="{'has-error': svairFormConjoint.referenceAvis.$invalid && svairFormConjoint.$submitted}">
            <label for="referenceAvis" class="control-label">Référence de votre dernier avis d'imposition</label>
            <input id="referenceAvis" type="text" name="referenceAvis" class="form-control" ng-model="newCredentials.referenceAvis" required>
            <div ng-messages="svairFormConjoint.referenceAvis.$error" ng-if="svairFormConjoint.$submitted">
              <p class="help-block" ng-message='required'>Ce champ est obligatoire.</p>
            </div>
          </div>

          <div ng-if="statusConjoint === 'error' && error">
            <p class="text-danger">{{error}}</p>
          </div>

          <div class="text-right">
            <a ng-if="statusConjoint" ng-click="cancelCredentials()" alt="Annuler" class="btn btn-lg btn-default">
                Annuler
            </a>
            <button type="submit" ladda="loading" data-style="expand-right" name="submit" alt="Valider" class="btn btn-lg btn-primary">
                Valider
            </button>
          </div>
        </form>
      </div>

      <div class="select-identites" ng-if="statusConjoint === 'success'">
        <div class="form-group">
          <label class="control-label">Vos identités fiscales</label><a class="edit-svair" ng-click="edit()">Modifier</a>
          <div class="identites">
            <div class="identite" ng-if="data.declarant1.nom">
              <span>{{data.declarant1.prenoms | capitalize:'first'}} {{data.declarant1.nom | capitalize:'first'}}</span>
              <small>Né(e) le {{data.declarant1.dateNaissance}}</small>
            </div>

            <div class="identite" ng-if="data.declarant1.nom">
              <span>{{data.declarant2.prenoms | capitalize:'first'}} {{data.declarant2.nom | capitalize:'first'}}</span>
              <small>Né(e) le {{data.declarant2.dateNaissance}}</small>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="control-label">Votre situation familiale</label>
          <div class="identite" ng-if="data.declarant1.nom">
            <span>{{data.situationFamille}}</span>
          </div>
        </div>
      </div>
    </div>
  </div> -->

  <div class="text-right">
    <button type="submit" name="submit" alt="Valider" class="btn btn-lg btn-success">
        Étape suivante
    </button>
  </div>
</form>
